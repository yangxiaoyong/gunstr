<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<meta name="robots" content="index,nofollow">

<title>PostfixBasicSetupHowto - Community Ubuntu Documentation</title>










<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static192/ubuntunew/css/msie.css">
<![endif]-->





<link rel="Start" href="https://help.ubuntu.com/community/UserDocumentation">
<link rel="Alternate" title="Wiki Markup" href="https://help.ubuntu.com/community/PostfixBasicSetupHowto?action=raw">
<link rel="Alternate" media="print" title="Print View" href="https://help.ubuntu.com/community/PostfixBasicSetupHowto?action=print">
<link rel="Appendix" title="PosfixRecieving.gif" href="https://help.ubuntu.com/community/PostfixBasicSetupHowto?action=AttachFile&amp;do=view&amp;target=PosfixRecieving.gif">
<link rel="Appendix" title="PostfixComponents.gif" href="https://help.ubuntu.com/community/PostfixBasicSetupHowto?action=AttachFile&amp;do=view&amp;target=PostfixComponents.gif">
<link rel="Appendix" title="PostfixComponentsNw.gif" href="https://help.ubuntu.com/community/PostfixBasicSetupHowto?action=AttachFile&amp;do=view&amp;target=PostfixComponentsNw.gif">
<link rel="Appendix" title="SetupOverview.jpg" href="https://help.ubuntu.com/community/PostfixBasicSetupHowto?action=AttachFile&amp;do=view&amp;target=SetupOverview.jpg">
<link rel="Search" href="https://help.ubuntu.com/community/FindPage">
<link rel="Index" href="https://help.ubuntu.com/community/TitleIndex">
<link rel="Glossary" href="https://help.ubuntu.com/community/WordIndex">
<link rel="Help" href="https://help.ubuntu.com/community/HelpOnFormatting">

<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body dir="ltr" lang="en">

<div id="round" class="roundme">
<img id="topcap" alt="" src="cap-top.png">
<div id="layout" class="container clear-block">
<div id="header">
<div id="logo-floater">
<h1><a href="http://help.ubuntu.com/" title="Ubuntu Documentation"><img alt="Ubuntu" id="logo" src="logo.png"></a></h1>
</div>



<form action="https://help.ubuntu.com/search.html" id="cse-search-box">  <div>    <input name="cof" value="FORID:9" type="hidden">    <input name="cx" value="004599128559784038176:vj_p0xo-nng" type="hidden">    <input name="ie" value="UTF-8" type="hidden">    <input value="" name="q" size="27" type="text">    <input name="sa" value="Search" type="submit">  </div></form>

<div id="sitename"><a href="https://help.ubuntu.com/community"><img src="help-faq.png"><span>Community Documentation</span></a></div>
</div> <!--header-->
<ul id="loginbar"><li><a href="https://help.ubuntu.com/community/PostfixBasicSetupHowto?action=login" id="login" rel="nofollow">Login to Edit</a></li></ul>


<!--1-->
<div id="page" dir="ltr" lang="en">

<!--2-->

<div id="breadcrumbs">
<a href="https://help.ubuntu.com/">Ubuntu Documentation</a> &gt; <a href="https://help.ubuntu.com/community">Community Documentation</a> &gt; <a class="backlink" href="https://help.ubuntu.com/community/PostfixBasicSetupHowto?action=fullsearch&amp;context=180&amp;value=linkto%3A%22PostfixBasicSetupHowto%22" rel="nofollow" title="Click to do a full-text search for this title">PostfixBasicSetupHowto</a>
</div>


<ul id="pagelocation">
<li><a class="backlink" href="https://help.ubuntu.com/community/PostfixBasicSetupHowto?action=fullsearch&amp;context=180&amp;value=linkto%3A%22PostfixBasicSetupHowto%22" rel="nofollow" title="Click to do a full-text search for this title">PostfixBasicSetupHowto</a></li>
</ul>

<!--3--><div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><div><table style="float: right; font-size: 0.9em; width: 40%; background: none repeat scroll 0% 0% rgb(241, 241, 237); margin: 0pt 0pt 1em 1em;"><tbody><tr>  <td style="padding: 0.5em;"><p class="line891"></p><div class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li>
<a href="#Introduction">Introduction</a></li><li>
<a href="#Setup_Overview">Setup Overview</a></li><li>
<a href="#Anatomy_of_Postfix">Anatomy of Postfix</a><ol><li>
<a href="#Components">Components</a></li><li>
<a href="#Receiving_Mail">Receiving Mail</a></li></ol></li><li>
<a href="#Install_Postfix">Install Postfix</a></li><li>
<a href="#Test_your_default_setup">Test your default setup</a></li><li>
<a href="#Setting_Postfix_Support_for_Maildir-style_Mailboxes">Setting Postfix Support for Maildir-style Mailboxes</a></li><li>
<a href="#Installing_courier_IMAP_and_POP3">Installing courier IMAP and POP3</a></li><li>
<a href="#Adding_your_local_domains_to_postfix">Adding your local domains to postfix</a></li><li>
<a href="#Testing_Courier_POP3">Testing Courier POP3</a></li><li>
<a href="#Testing_Courier_IMAP">Testing Courier IMAP</a></li><li>
<a href="#Local_Alias_database">Local Alias database</a><ol><li>
<a href="#Creating_an_alias_for_an_account">Creating an alias for an account</a></li></ol></li><li>
<a href="#Per_User_.forward_Files">Per User .forward Files</a></li><li>
<a href="#Postfix_virtual_Aliases_for_separate_domains_and_Linux_system_accounts">Postfix virtual Aliases for separate domains and Linux system accounts</a></li></ol></div></td>
</tr>
</tbody></table></div><span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line867">
</p><h1 id="Introduction">Introduction</h1>
<span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line862">This document will teach you how to set up a basic Postfix mail server with IMAP and POP3 services. It does not included advanced topics such as integrating virus-checking and spam-filtering, which are dealt with in <a href="https://help.ubuntu.com/community/PostfixVirtualMailBoxClamSmtpHowto">PostfixVirtualMailBoxClamSmtpHowto</a> and <a href="https://help.ubuntu.com/community/PostfixCompleteVirtualMailSystemHowto">PostfixCompleteVirtualMailSystemHowto</a>. <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span></p><p class="line867">
</p><h1 id="Setup_Overview">Setup Overview</h1>
<span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line874">In our setup, Postfix sends and receives mail from Internet and stores them in the user mailboxes while clients on the Internet can retrieve their mails via Courier IMAP or POP3. The user authentication is done by Courier Authdaemon. The following diagram shows this process. <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span></p><p class="line867"><strong><img alt="SetupOverview.jpg" class="attachment" src="postfixbasicsetuphowto" title="SetupOverview.jpg"></strong> <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span></p><p class="line867">
</p><h1 id="Anatomy_of_Postfix">Anatomy of Postfix</h1>
<span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line867">
</p><h2 id="Components">Components</h2>
<span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line874">The following figure shows the main Postfix system components, and the main information flows between them. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span></p><p class="line867"><strong><img alt="PostfixComponentsNw.gif" class="attachment" src="postfixbasicsetuphowto_001.dat" title="PostfixComponentsNw.gif"></strong> <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span></p><ul><li>Yellow ellipsoids are mail programs. <span class="anchor" id="line-24"></span></li><li>Yellow boxes are mail queues or files. <span class="anchor" id="line-25"></span></li><li>Blue boxes are lookup tables. <span class="anchor" id="line-26"></span></li><li>Programs in the large box run under control by the Postfix resident master daemon. <span class="anchor" id="line-27"></span></li><li>Data in the large box is property of the Postfix mail system. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span></li></ul><p class="line867">
</p><h2 id="Receiving_Mail">Receiving Mail</h2>
<span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line874">When a message enters the Postfix mail system, the first stop is the incoming queue. The figure below shows the main components that are involved with new mail. <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span></p><p class="line867"><strong><img alt="PosfixRecieving.gif" class="attachment" src="postfixbasicsetuphowto_002.dat" title="PosfixRecieving.gif"></strong> <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span></p><ul><li><p class="line862">Mail is posted locally. The Postfix <a class="http" href="http://www.postfix.org/sendmail.1.html">sendmail</a> program invokes the privileged <a class="http" href="http://www.postfix.org/postdrop.1.html">postdrop</a> program which deposits the message into the <strong>maildrop</strong> directory, where the message is picked up by the <a class="http" href="http://www.postfix.org/pickup.8.html">pickup</a> daemon. This daemon does some sanity checks, in order to protect the rest of the Postfix system. <span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span></p></li><li class="gap"><p class="line862">Mail comes in via the network. The Postfix <a class="http" href="http://www.postfix.org/smtpd.8.html">SMTP server</a> receives the message and does some sanity checks, in order to protect the rest of the Postfix system. <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span></p></li><li class="gap"><p class="line862">Mail is generated internally by the Postfix system itself, in order to return undeliverable mail to the sender. The <a class="http" href="http://www.postfix.org/bounce.8.html">bounce or defer</a> daemon brings the bad news. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span></p></li><li class="gap"><p class="line862">Mail is forwarded by the <a class="http" href="http://www.postfix.org/local.8.html">local</a> delivery agent, either via an entry in the system-wide <a class="http" href="http://www.postfix.org/aliases.5.html">alias</a> database, or via an entry in a per-user <a class="http" href="http://www.postfix.org/aliases.5.html">.forward</a> file. This is indicated with the unlabeled arrow. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span></p></li><li class="gap"><p class="line862">Mail is generated internally by the Postfix system itself, in order to <a class="http" href="http://www.postfix.org/basic.html#notify">notify</a> the postmaster of a problem (this path is also indicated with the unlabeled arrow).The Postfix system can be configured to notify the postmaster of SMTP protocol problems, <a class="http" href="http://en.wikipedia.org/wiki/E-mail_spam">UCE</a> policy violations, and so on. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span></p></li><li class="gap"><p class="line862">The <a class="http" href="http://www.postfix.org/cleanup.8.html">cleanup</a> daemon implements the final processing stage for new mail. It adds missing <strong>From:</strong> and other message headers, arranges for address rewriting to the standard <a class="mailto" href="mailto:user@fully.qualified.domain">user@fully.qualified.domain</a> form, and optionally extracts recipient addresses from message headers. The <strong>cleanup</strong> daemon inserts the result as a single queue file into the <strong>incoming</strong> queue, and notifies the <a class="http" href="http://www.postfix.org/qmgr.8.html">queue manager</a> of the arrival of new mail. The <strong>cleanup</strong> daemon can be configured to transform addresses on the basis of <a class="http" href="http://www.postfix.org/rewrite.html#canonical">canonical</a> and <a class="http" href="http://www.postfix.org/rewrite.html#virtual">virtua</a> table lookups. <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span></p></li><li class="gap"><p class="line862">On request by the cleanup daemon, the <a class="http" href="http://www.postfix.org/trivial-rewrite.8.html">trivial-rewrite</a> daemon rewrites addresses to the standard <a class="mailto" href="mailto:user@fully.qualified.domain">user@fully.qualified.domain</a> form. <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span></p></li></ul><p class="line867">
</p><h1 id="Install_Postfix">Install Postfix</h1>
<span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><p class="line862">In this setup I assume that your domain is <tt>yourdomain.com</tt> and it has a valid MX record setup as <tt>mail.yourdomain.com</tt>. Remember to replace <tt>yourdomain.com</tt> with your actual domain in the example codes in this howto. Also I assume that you know what an MX record is. To find out MX your type in a terminal: <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></p><p class="line867"><span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span></p><pre><span class="anchor" id="line-1"></span>dig mx yourdomain.com</pre><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><p class="line867"><strong>To install postfix</strong> <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span></p><p class="line867"><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span></p><pre><span class="anchor" id="line-1-1"></span>sudo apt-get install postfix</pre><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><p class="line874">Install mailx package for use as command mail utility program. Mail command is installed with this package. <span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span></p><p class="line867"><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span></p><pre><span class="anchor" id="line-1-2"></span>sudo apt-get install mailutils</pre><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><p class="line867">
</p><h1 id="Test_your_default_setup">Test your default setup</h1>
<span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><p class="line874">Add a user before you start this. <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span></p><p class="line867"><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span></p><pre><span class="anchor" id="line-1-3"></span>sudo useradd -m -s /bin/bash fmaster
<span class="anchor" id="line-2"></span>sudo passwd fmaster</pre><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><p class="line874">Test your default installation using the following code segment. <span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span></p><p class="line867"><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span></p><pre><span class="anchor" id="line-1-4"></span>telnet localhost 25</pre><span class="anchor" id="line-84"></span><p class="line874">(if that doesn't work, check to see if postfix is running) <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span></p><pre><span class="anchor" id="line-1-5"></span>sudo postfix status</pre><span class="anchor" id="line-88"></span><p class="line874">If it is not running, start it <span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span></p><pre><span class="anchor" id="line-1-6"></span>sudo postfix start</pre><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><p class="line874">Postfix will prompt like following in the terminal so that you can use to type SMTP commands. <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span></p><p class="line867"><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span></p><pre><span class="anchor" id="line-1-7"></span>Trying 127.0.0.1...
<span class="anchor" id="line-2-1"></span>Connected to mail.fossedu.org.
<span class="anchor" id="line-3"></span>Escape character is '^]'.
<span class="anchor" id="line-4"></span>220 localhost.localdomain ESMTP Postfix (Ubuntu)</pre><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><p class="line874">Type the following code segment in Postfix's prompt. <span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span></p><p class="line867"><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span></p><pre><span class="anchor" id="line-1-8"></span>ehlo localhost
<span class="anchor" id="line-2-2"></span>mail from: root@localhost
<span class="anchor" id="line-3-1"></span>rcpt to: fmaster@localhost
<span class="anchor" id="line-4-1"></span>data
<span class="anchor" id="line-5"></span>Subject: My first mail on Postfix
<span class="anchor" id="line-6"></span>
<span class="anchor" id="line-7"></span>Hi,
<span class="anchor" id="line-8"></span>Are you there?
<span class="anchor" id="line-9"></span>regards,
<span class="anchor" id="line-10"></span>Admin
<span class="anchor" id="line-11"></span>. (Type the .[dot] in a new Line and press Enter )
<span class="anchor" id="line-12"></span>quit</pre><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><p class="line862">Check the mailbox of <tt>fmaster</tt> <span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span></p><p class="line867"><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span></p><pre><span class="anchor" id="line-1-9"></span>su - fmaster
<span class="anchor" id="line-2-3"></span>mail</pre><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><p class="line862">When you type <tt>mail</tt> command an output like follows display in your terminal. <span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span></p><p class="line867"><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span></p><pre><span class="anchor" id="line-1-10"></span>Mail version 8.1.2 01/15/2001.  Type ? for help.
<span class="anchor" id="line-2-4"></span>"/var/mail/fmaster": 2 messages 2 new
<span class="anchor" id="line-3-2"></span>&gt;N  1 root@localhost     Mon Mar  6 12:49   13/479   Just a test
<span class="anchor" id="line-4-2"></span> N  2 root@localhost     Mon Mar  6 12:51   15/487   My first mail
<span class="anchor" id="line-5-1"></span>&amp;</pre><span class="anchor" id="line-136"></span><p class="line862">You will observe that mails are indexed by numbers and you can type the number of which the mail that you want to read. For example type no <tt>"2"</tt> to read the 2nd mail. The type <tt>"q"</tt> to quit. The mail will be written to a file called <tt>mbox</tt> in user's home directory. According to our example it will be <tt>/home/fmaster/mbox</tt>. <span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span></p><p class="line874">All messages in an mbox type of mailbox are concatenated and stored in a single file. The beginning of each message is indicated by a line whose first five characters are "From " and a blank line is appended to the end of each message <span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span></p><p class="line867">
</p><h1 id="Setting_Postfix_Support_for_Maildir-style_Mailboxes">Setting Postfix Support for Maildir-style Mailboxes</h1>
<span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><p class="line874">Maildir is a format for an e-mail spool that does not require file locking to maintain message integrity because the messages are kept in separate files with unique names. A Maildir is a directory (often named Maildir) with three subdirectories named tmp, new, and cur. The subdirectories should all reside on the same filesystem. <span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span></p><p class="line874">Another reason to use Maildir format is that Courier IMAP/POP3 servers only work with  Maildir format of mailboxes. <span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span></p><p class="line862">Please find out more about Maildir <a class="http" href="http://en.wikipedia.org/wiki/Maildir">here</a> <span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span></p><p class="line874">Instruct Postfix to use Maildirs instead of Mboxes: <span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span></p><p class="line867"><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span></p><pre><span class="anchor" id="line-1-11"></span> sudo postconf -e "home_mailbox = Maildir/"</pre><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><p class="line874">Ensure Procmail isn't used: (if the step was taken during dpkg-reconfigure, by mistake) <span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span></p><p class="line867"><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span></p><pre><span class="anchor" id="line-1-12"></span>sudo postconf -e "mailbox_command = "</pre><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><p class="line867"><strong>Restart Postfix</strong> to make changes effect. <span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span></p><p class="line867"><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span></p><pre><span class="anchor" id="line-1-13"></span>sudo  /etc/init.d/postfix restart</pre><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><p class="line874">Test your setup again <span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span></p><p class="line862">Check the mailbox of <tt>fmaster</tt> <span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span></p><p class="line867"><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span></p><pre><span class="anchor" id="line-1-14"></span>su - fmaster
<span class="anchor" id="line-2-5"></span>MAIL=/home/fmaster/Maildir
<span class="anchor" id="line-3-3"></span>mail</pre><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><p class="line867">
</p><h1 id="Installing_courier_IMAP_and_POP3">Installing courier IMAP and POP3</h1>
<span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><p class="line867"><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span></p><pre><span class="anchor" id="line-1-15"></span>sudo apt-get install courier-pop
<span class="anchor" id="line-2-6"></span>sudo apt-get install courier-imap</pre><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><p class="line867">
</p><h1 id="Adding_your_local_domains_to_postfix">Adding your local domains to postfix</h1>
<span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><p class="line862">Add your domains to <tt>mydestination</tt>: <span class="anchor" id="line-187"></span>(my destination is a value in the postfix configuration file. to view your existing setting, type sudo postconf mydestination) <span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span></p><p class="line867"><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span></p><pre><span class="anchor" id="line-1-16"></span>sudo postconf -e "mydestination = mail.fossedu.org, localhost.localdomain, localhost, yourdomain.com"</pre><span class="anchor" id="line-192"></span><p class="line874">(note that command above will overwrite your previous settings of mydestination, so make note of your previous entries) <span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span></p><p class="line867"><strong>Add your local networks, too:</strong> <span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span></p><p class="line874">Postfix comes with the localhost (127.0.0.1) entry; you may have others, here we assume your LAN is on 192.168.1.0/24.  Make changes to suit your situation. <span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span></p><p class="line867"><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span></p><pre><span class="anchor" id="line-1-17"></span>sudo postconf -e "mynetworks = 127.0.0.0/8, 192.168.1.0/24"</pre><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><p class="line867"><strong>Make Postfix to receive mail from the Internet</strong> <span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span></p><p class="line874">Instruct Postfix to receive on all interfaces: <span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span></p><p class="line867"><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span></p><pre><span class="anchor" id="line-1-18"></span>sudo postconf -e "inet_interfaces = all"</pre><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><p class="line867"><strong>(optional) Make Postfix accept IPv4, IPv6 protocols</strong> <span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span></p><p class="line874">If you're not using IPv6 yet, and you're paranoid, use "ipv4" instead of "all". Again, this is to suit your own network sensibilities. <span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span></p><p class="line867"><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span></p><pre><span class="anchor" id="line-1-19"></span>sudo postconf -e "inet_protocols = all"</pre><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><p class="line874">Finally, restart Postfix; <span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span></p><p class="line867"><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span></p><pre><span class="anchor" id="line-1-20"></span>sudo  /etc/init.d/postfix restart</pre><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><p class="line874">Test your setup again using following code: <span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span></p><p class="line867"><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span></p><pre><span class="anchor" id="line-1-21"></span>netcat mail.yourdomain.com 25
<span class="anchor" id="line-2-7"></span>ehlo yourdomain.com
<span class="anchor" id="line-3-4"></span>mail from: root@yourdomain.com
<span class="anchor" id="line-4-3"></span>rcpt to: fmaster@yourdomain.com
<span class="anchor" id="line-5-2"></span>data
<span class="anchor" id="line-6-1"></span>Subject: My first mail for my domain
<span class="anchor" id="line-7-1"></span>
<span class="anchor" id="line-8-1"></span>Hi,
<span class="anchor" id="line-9-1"></span>Are you there?
<span class="anchor" id="line-10-1"></span>regards,
<span class="anchor" id="line-11-1"></span>Admin
<span class="anchor" id="line-12-1"></span>. (and Enter In a new Line)
<span class="anchor" id="line-13"></span>quit</pre><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><p class="line862">Check the mailbox of <tt>fmaster</tt> <span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span></p><p class="line867"><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span></p><pre><span class="anchor" id="line-1-22"></span>su - fmaster
<span class="anchor" id="line-2-8"></span>cd Maildir/new
<span class="anchor" id="line-3-5"></span>ls</pre><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><p class="line874">Now you will see mail has a separate file. <span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span></p><p class="line867">
</p><h1 id="Testing_Courier_POP3">Testing Courier POP3</h1>
<span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><p class="line874">Type in a terminal: <span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span></p><p class="line867"><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span></p><pre><span class="anchor" id="line-1-23"></span>netcat mail.yourdomain.com 110</pre><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><p class="line874">Use the following example code segment for your test. Be intelligent to tweak the changes appropriately to your environment. An output like follows will display in your terminal. <span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span></p><p class="line867"><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span></p><pre><span class="anchor" id="line-1-24"></span>Connected to mail.yourdomain.com (208.77.188.166).
<span class="anchor" id="line-2-9"></span>Escape character is '^]'.
<span class="anchor" id="line-3-6"></span>+OK Hello there.</pre><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><p class="line862">Type the following code segment in the prompt provided by the Courier POP3 server. I assume that you are intelligent enough not to type the lines which starts from <tt>+OK</tt> <span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span></p><p class="line867"><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span></p><pre><span class="anchor" id="line-1-25"></span>user fmaster
<span class="anchor" id="line-2-10"></span>+OK Password required.
<span class="anchor" id="line-3-7"></span>pass password
<span class="anchor" id="line-4-4"></span>+OK logged in.
<span class="anchor" id="line-5-3"></span>quit</pre><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><p class="line867">
</p><h1 id="Testing_Courier_IMAP">Testing Courier IMAP</h1>
<span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><p class="line874">Type in a terminal: <span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span></p><p class="line867"><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span></p><pre><span class="anchor" id="line-1-26"></span>netcat mail.yourdomain.com 143</pre><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><p class="line874">Use the following example code segment for your test. Be intelligent and tweak the changes appropriately to your environment. An output like follows will display in your terminal. <span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span></p><p class="line867"><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span></p><pre><span class="anchor" id="line-1-27"></span>* OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE ACL ACL2=UNION STARTTLS XCOURIEROUTBOX=INBOX.Outbox] Courier-IMAP ready. Copyright 1998-2005 Double Precision, Inc.  See COPYING for distribution information.</pre><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><p class="line874">Type the following code segment in the prompt provided by the Courier IMAP server. <span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span></p><p class="line867"><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span></p><pre><span class="anchor" id="line-1-28"></span>a login fmaster password
<span class="anchor" id="line-2-11"></span>a OK LOGIN Ok.
<span class="anchor" id="line-3-8"></span>a logout</pre><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><p class="line867">
</p><h1 id="Local_Alias_database">Local Alias database</h1>
<span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><p class="line862">When mail is to be delivered locally, the local delivery agent runs each local recipient name through the  aliases database. The mapping does not affect addresses in message headers. Local aliases are typically used to implement distribution lists, or to direct mail for standard aliases such as <strong>postmaster</strong> to real people. The table can also be used to map Firstname.Lastname addresses to login names. <span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span></p><p class="line862">Alias lookups are enabled by default and you will see following code segment in <strong>main.cf</strong> file. <span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span></p><p class="line867"><span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span></p><pre><span class="anchor" id="line-1-29"></span>...
<span class="anchor" id="line-2-12"></span>alias_maps = hash:/etc/aliases
<span class="anchor" id="line-3-9"></span>...</pre><span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><p class="line867">
</p><h2 id="Creating_an_alias_for_an_account">Creating an alias for an account</h2>
<span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><p class="line874">The following codes illustrate how you can setup an alias. This step is optional since we are going to configure virtual mail domains later in this howto. I have added this step to make sure you understand how you can do this in case it is required. <span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span></p><p class="line867"><strong>Create a user</strong> <span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span></p><p class="line867"><span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span></p><pre><span class="anchor" id="line-1-30"></span>sudo useradd -m -s /bin/bash sysadmin
<span class="anchor" id="line-2-13"></span>sudo passwd sysadmin</pre><span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><p class="line867"><strong>Edit the alias table</strong> <span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span></p><p class="line874">Open the alias file with: <span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span></p><p class="line867"><span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span></p><pre><span class="anchor" id="line-1-31"></span>sudo vi /etc/aliases</pre><span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><p class="line874">Add the following code: <span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span></p><p class="line867"><span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span></p><pre><span class="anchor" id="line-1-32"></span>fmaster: sysadmin</pre><span class="anchor" id="line-337"></span><span class="anchor" id="line-338"></span><p class="line874">To make your changes take effect type: <span class="anchor" id="line-339"></span><span class="anchor" id="line-340"></span></p><p class="line867"><span class="anchor" id="line-341"></span><span class="anchor" id="line-342"></span></p><pre><span class="anchor" id="line-1-33"></span>sudo newaliases</pre><span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span><p class="line862">To test your changes send a mail to <tt>fmaster</tt> and check the mail in <tt>/home/sysadmin/Maildir/new</tt> folder. <span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span></p><p class="line867">
</p><h1 id="Per_User_.forward_Files">Per User .forward Files</h1>
<span class="anchor" id="line-348"></span><span class="anchor" id="line-349"></span><p class="line874">Users can control their own mail delivery by specifying destinations in a file called .forward in their home directories. The syntax of these files is the same as system aliases, except that the lookup key and colon are not present. <span class="anchor" id="line-350"></span><span class="anchor" id="line-351"></span></p><p class="line874">I will illustrate an example here: <span class="anchor" id="line-352"></span><span class="anchor" id="line-353"></span></p><p class="line874">Assume that you need to forward all the mails which come to the sysadmin account to an another account.  Enter the following commands: <span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span></p><p class="line867"><span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span><span class="anchor" id="line-358"></span></p><pre><span class="anchor" id="line-1-34"></span>su - sysadmin
<span class="anchor" id="line-2-14"></span>touch .forward</pre><span class="anchor" id="line-359"></span><span class="anchor" id="line-360"></span><p class="line874">Then open the .forward file <span class="anchor" id="line-361"></span><span class="anchor" id="line-362"></span></p><p class="line867"><span class="anchor" id="line-363"></span><span class="anchor" id="line-364"></span></p><pre><span class="anchor" id="line-1-35"></span>vi .forward</pre><span class="anchor" id="line-365"></span><span class="anchor" id="line-366"></span><p class="line874">Add  the following code: <span class="anchor" id="line-367"></span><span class="anchor" id="line-368"></span></p><p class="line867"><span class="anchor" id="line-369"></span><span class="anchor" id="line-370"></span></p><pre><span class="anchor" id="line-1-36"></span>fossedu@example.com</pre><span class="anchor" id="line-371"></span><span class="anchor" id="line-372"></span><p class="line874">Remember to use email address which exists in this exercise. <span class="anchor" id="line-373"></span><span class="anchor" id="line-374"></span></p><p class="line862">Now send a mail to <tt>sysadmin</tt> and mail should come to <a class="mailto" href="mailto:fossedu@example.com">fossedu@example.com</a> <span class="anchor" id="line-375"></span><span class="anchor" id="line-376"></span></p><p class="line867">
</p><h1 id="Postfix_virtual_Aliases_for_separate_domains_and_Linux_system_accounts">Postfix virtual Aliases for separate domains and Linux system accounts</h1>
<span class="anchor" id="line-377"></span><span class="anchor" id="line-378"></span><p class="line874">With this approach, every hosted domain can have its own info etc. email address. However, it still uses Linux system accounts for local mailbox deliveries. <span class="anchor" id="line-379"></span><span class="anchor" id="line-380"></span></p><p class="line874">With virtual alias domains, each hosted address is aliased to a local UNIX system account or to a remote address. The example below shows how to use this mechanism for the fossedu.org and linuxelabs.com domains. <span class="anchor" id="line-381"></span><span class="anchor" id="line-382"></span></p><p class="line862">Inside the <strong>main.cf</strong> file, we tell it how to handle these virtual domains: <span class="anchor" id="line-383"></span><span class="anchor" id="line-384"></span></p><p class="line867"><span class="anchor" id="line-385"></span><span class="anchor" id="line-386"></span><span class="anchor" id="line-387"></span></p><pre><span class="anchor" id="line-1-37"></span>sudo postconf -e "virtual_alias_domains = fossedu.org linuxelabs.com"
<span class="anchor" id="line-2-15"></span>sudo postconf -e "virtual_alias_maps = hash:/etc/postfix/virtual"</pre><span class="anchor" id="line-388"></span><span class="anchor" id="line-389"></span><p class="line862">Edit the <tt>/etc/postfix/virtual</tt> file: <span class="anchor" id="line-390"></span><span class="anchor" id="line-391"></span><span class="anchor" id="line-392"></span></p><p class="line874">Add two Linux system accounts <span class="anchor" id="line-393"></span><span class="anchor" id="line-394"></span></p><p class="line867"><span class="anchor" id="line-395"></span><span class="anchor" id="line-396"></span><span class="anchor" id="line-397"></span></p><pre><span class="anchor" id="line-1-38"></span>sudo useradd -m -s /bin/bash sigiri
<span class="anchor" id="line-2-16"></span>sudo useradd -m -s /bin/bash kala</pre><span class="anchor" id="line-398"></span><span class="anchor" id="line-399"></span><p class="line874">Set passwords for the above users. <span class="anchor" id="line-400"></span><span class="anchor" id="line-401"></span></p><p class="line867"><span class="anchor" id="line-402"></span><span class="anchor" id="line-403"></span><span class="anchor" id="line-404"></span></p><pre><span class="anchor" id="line-1-39"></span>sudo passwd sigiri
<span class="anchor" id="line-2-17"></span>sudo passwd kala</pre><span class="anchor" id="line-405"></span><span class="anchor" id="line-406"></span><span class="anchor" id="line-407"></span><p class="line867"><span class="anchor" id="line-408"></span><span class="anchor" id="line-409"></span></p><pre><span class="anchor" id="line-1-40"></span>sudo vi /etc/postfix/virtual</pre><span class="anchor" id="line-410"></span><span class="anchor" id="line-411"></span><p class="line874">Add the following code segment: <span class="anchor" id="line-412"></span><span class="anchor" id="line-413"></span></p><p class="line867"><span class="anchor" id="line-414"></span><span class="anchor" id="line-415"></span><span class="anchor" id="line-416"></span></p><pre><span class="anchor" id="line-1-41"></span>info@fossedu.org       sigiri
<span class="anchor" id="line-2-18"></span>info@linuxelabs.com    kala</pre><span class="anchor" id="line-417"></span><span class="anchor" id="line-418"></span><p class="line874">To create a Map Database type : <span class="anchor" id="line-419"></span><span class="anchor" id="line-420"></span><span class="anchor" id="line-421"></span></p><pre><span class="anchor" id="line-1-42"></span>sudo postmap /etc/postfix/virtual</pre><span class="anchor" id="line-422"></span><p class="line862">postmap is  utility program that will convert <tt>/etc/postfix/virtual</tt> to <tt>/etc/postfix/virtual.db</tt> in Berkley DB format, so that Postfix can access the data faster. <span class="anchor" id="line-423"></span><span class="anchor" id="line-424"></span></p><p class="line874">Restart Postfix to make changes take effect: <span class="anchor" id="line-425"></span><span class="anchor" id="line-426"></span></p><p class="line867"><span class="anchor" id="line-427"></span><span class="anchor" id="line-428"></span></p><pre><span class="anchor" id="line-1-43"></span>sudo /etc/init.d/postfix restart</pre><span class="anchor" id="line-429"></span><span class="anchor" id="line-430"></span><p class="line862">Send mails to both <a class="mailto" href="mailto:info@fossedu.org">info@fossedu.org</a> and <a class="mailto" href="mailto:info@linuxelabs.com">info@linuxelabs.com</a> and those mails should come to mailboxes of  <strong>sigiri</strong> and <strong>kala</strong> respectively. <span class="anchor" id="line-431"></span><span class="anchor" id="bottom"></span></p></div><p id="pageinfo" class="info" dir="ltr" lang="en">PostfixBasicSetupHowto  (last edited 2011-04-27 12:37:01 by <span title="https://login.launchpad.net/+id/FrcHWH4 @ pool-98-116-50-72.nycmny.fios.verizon.net[98.116.50.72]"><a class="interwiki" href="https://launchpad.net/%7Emarjo-mercado" title="https://login.launchpad.net/+id/FrcHWH4 @ pool-98-116-50-72.nycmny.fios.verizon.net[98.116.50.72]">marjo-mercado</a></span>)</p>

<ul class="pagelinks">
<li><a class="nbinfo" href="https://help.ubuntu.com/community/PostfixBasicSetupHowto?action=info" rel="nofollow">Page History</a></li>
</ul>

<div id="pagebottom"></div>
</div>


<div id="footer">
<hr width="550px">

  <div id="ubuntulinks">
	<p>
	      The material on this wiki is available under a free license, see <a href="https://help.ubuntu.com/community/License">Copyright / License</a> for details<br><b>You</b> can contribute to this wiki, see <a href="https://help.ubuntu.com/community/WikiGuide">Wiki Guide</a> for details
	</p><br>
  </div>





</div> <!-- footer -->
</div> <!-- layout -->
<img id="bottomcap" alt="" src="cap-bottom.png">
</div> <!-- round -->



</body>
</html>
